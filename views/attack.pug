extends layout

block content
  p
  h2 Character: #{char.display}
  h2 Attack: #{attack.name}

  form(method="post" action="/attack" onsubmit="return(validate())")
    table
      tbody
        tr
          th Targets
          th 1&deg;
          th Roll
          th Bonus
          th 2&deg;
        each char in chars
          tr
            td #{char.display}
            td
              input(type='checkbox' name=char.name+'_pri')
            td
              input(type='number' name=char.name+'_roll')
            td
              input(type='number' name=char.name+'_bonus' value=0)
            td 
              input(type='checkbox' name=char.name+'_sec')
      if attack.secondaryMax > 0 && attack.rollForSecondary
        tbody
          tr
            th(colspan=5) Numbers for secondary attack
          tr
            td(colspan=2)
            td
              input(type='number' name='roll')
            td
              input(type='number' name='bonus' value=0)
            td

    input(type="hidden" name="name" value=char.name)
    input(type="hidden" name="attack" value=attack.name)
    input(type="hidden" name="primaryMax" value=attack.primaryMax)
    input(type="hidden" name="secondaryMax" value=attack.secondaryMax)
    input(type="hidden" name="primaryMin" value=attack.primaryMin)
    input(type="hidden" name="secondaryMin" value=attack.secondaryMin)
    input(type="hidden" name="chars" value=charList)
    input(type="hidden" name="stage" value="1")
    br
    p
    button(type="submit") Attack
    a(onclick="validate()") Test

    if attack.primaryMin === attack.primaryMax
      p Primary targets required: #{attack.primaryMax}
    else if attack.primaryMax === 999
      p Primary targets required: #{attack.primaryMin} or more
    else
      p Primary targets required: #{attack.primaryMin} to #{attack.primaryMax}
      
    if attack.secondaryMin === attack.secondaryMax
      p Secondary targets required: #{attack.secondaryMax}
    else if attack.secondaryMax === 999
      p Secondary targets required: #{attack.secondaryMin} or more
    else
      p Secondary targets required: #{attack.secondaryMin} to #{attack.secondaryMax}
    

  div(id="errors" class="errors")

  include attack_validation.html
